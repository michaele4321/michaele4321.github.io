<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Comparing Semantic Extraction Tools</title>
  <meta name="description" content="How do you compare the performance of semantic extraction tools?">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="/semantics/2017/07/26/comparing-semantic-extraction-tools.html">
  <link rel="alternate" type="application/rss+xml" title="Michael&#39;s Notes" href="/feed.xml">
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/">Michael&#39;s Notes</a>
  
    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
          
            
            
            <a class="page-link" href="/about/">About</a>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Comparing Semantic Extraction Tools</h1>
    <p class="post-meta">
      <time datetime="2017-07-26T10:48:25+10:00" itemprop="datePublished">
        
        Jul 26, 2017
      </time>
      </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <blockquote>
  <p>How do you compare the performance of semantic extraction tools?</p>
</blockquote>

<h2 id="introduction">Introduction</h2>
<p>In common with many organisations, we are looking at using semantic extraction tools to suggest metadata tags
that can be applied to our content to help with grouping and finding content.
We have a large amount of existing content that has been manually tagged over many years by many different people
but they have been using a common controlled vocabulary so the tagging is somewhat consistent.
Automated semantic extraction tools are now available from lots of different providers and seem to have reached a level that makes them usable for production purposes.</p>

<h2 id="the-problem">The Problem</h2>
<p>Once we started looking into these tools, I needed to answer the question “How do you compare the performance of semantic extraction tools?” I want to be able to generate some sort of metric that I can use to measure a semantic extraction tool’s performance on our content. The hope is to be able to generate this metric for a number of semantic extraction tools and choose the best fit for our needs.</p>
<h2 id="the-approach">The Approach</h2>
<p>I first generated a set of test content by picking several thousand items from our content library. Our content varies in popularity so I ranked our content by popularity and then selected items to get a roughly proportional sample.</p>

<p>I mainly used r with a small amount of Oracle SQL to prepare the data.</p>

<h3 id="preparing-the-data">Preparing the data</h3>
<h4 id="popularity-data">Popularity data</h4>
<p>The popularity data looks like this</p>
<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;</span><span class="w"> </span><span class="n">str</span><span class="p">(</span><span class="n">popularity</span><span class="p">)</span><span class="w">
</span><span class="s1">'data.frame'</span><span class="o">:</span><span class="w">	</span><span class="m">295000</span><span class="w"> </span><span class="n">obs.</span><span class="w"> </span><span class="n">of</span><span class="w">  </span><span class="m">2</span><span class="w"> </span><span class="n">variables</span><span class="o">:</span><span class="w">
 </span><span class="o">$</span><span class="w"> </span><span class="n">id</span><span class="w">   </span><span class="o">:</span><span class="w"> </span><span class="n">Factor</span><span class="w"> </span><span class="n">w</span><span class="o">/</span><span class="w"> </span><span class="m">295000</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="s2">"26910"</span><span class="p">,</span><span class="s2">"26916"</span><span class="p">,</span><span class="n">..</span><span class="o">:</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">9</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="n">...</span><span class="w">
 </span><span class="o">$</span><span class="w"> </span><span class="n">reads</span><span class="o">:</span><span class="w"> </span><span class="n">int</span><span class="w">  </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">18</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="n">...</span><span class="w">
</span></code></pre>
</div>
<p>Its a typical log distribution</p>
<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">hist</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">popularity</span><span class="o">$</span><span class="n">reads</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>
<p><img src="/assets/images/2017-07-27-comparing-semantic-extraction-tools-76aa2.png" alt="plot1" /></p>

<h4 id="content-data">Content data</h4>
<p>Our content is in an Oracle DB so to select a subset I uploaded the popularity data to Oracle and then joined it to the documents.</p>

<p>To explain the way I generated the subset lets look at this in stages.
Firstly how to select a sample of documents in Oracle?
Start with a table “content” with at least a column called “id_”</p>
<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">WITH</span> <span class="n">rowcount</span> <span class="k">as</span> <span class="p">(</span><span class="k">select</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">count_</span> <span class="k">from</span> <span class="n">content</span><span class="p">)</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">content</span>
<span class="k">where</span> <span class="n">ORA_HASH</span><span class="p">(</span><span class="n">id_</span><span class="p">,(</span><span class="k">select</span> <span class="n">count_</span> <span class="k">from</span> <span class="n">rowcount</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">12345</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="k">select</span> <span class="n">count_</span> <span class="k">from</span> <span class="n">rowcount</span><span class="p">)</span><span class="o">*</span><span class="mi">5</span><span class="o">/</span><span class="mi">100</span>
</code></pre>
</div>
<p>The first line <code class="highlighter-rouge">WITH row_count as (select count(*) count_ from content)</code> creates a ‘virtual’ temporary table called row_count with the total number of content items.
The ORA_HASH function computes a hash from the data it is passed. In this case we are passing in the unique id of the content. The second argument to ORA_HASH <code class="highlighter-rouge">(select count_ from row_count)-1</code> is one less than the total number of content items (the -1 is because the ORA_HASH value is <a href="https://xkcd.com/163/">zero based</a>). The third argument to ORA_HASH <code class="highlighter-rouge">12345</code> is a randomization seed, it doesn’t really matter for our purposes what we use here.
The result of the ORA_HASH function on the id_ field is a number between 0 and the number of items in the table. The number does not reflect any existing order of the table so we have essentially shuffled the data in random order.
The final step is to select a sample from this newly randomized list of content. We do this by selecting items whose ORA_HASH value is less than some number. In this example the number is <code class="highlighter-rouge">(select count_ from rowcount)*5/100</code> or 5% of the number of items in the content table.</p>
<p class="note">Its easy to confuse this for a process that selects 5% of the items. That is not what this process does. The result of this is a query that gives a 5% chance that any particular article is selected.</p>

<p>Now how do we select a sample of content adjusting for the popularity of the content?
Lets assume we have a table called “popularity” with two columns “id_” and “reads_” as well as the existing table “content” with at least a column “id_”.</p>
<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">with</span>
  <span class="n">content_popularity</span> <span class="k">as</span> <span class="p">(</span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">content</span> <span class="k">join</span> <span class="n">popularity</span> <span class="k">on</span> <span class="n">content</span><span class="p">.</span><span class="n">id_</span><span class="o">=</span><span class="n">popularity</span><span class="p">.</span><span class="n">id_</span><span class="p">),</span>
  <span class="n">rowcount</span> <span class="k">as</span> <span class="p">(</span><span class="k">select</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">count_</span> <span class="k">from</span> <span class="n">content</span><span class="p">)</span>
<span class="k">select</span> <span class="n">content_popularity</span><span class="p">.</span><span class="n">id_</span><span class="p">,</span> <span class="n">content_popularity</span><span class="p">.</span><span class="n">reads_</span>
<span class="k">from</span> <span class="n">content_popularity</span>
<span class="k">where</span>   <span class="n">ORA_HASH</span><span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="p">(</span><span class="k">select</span> <span class="n">count_</span> <span class="k">from</span> <span class="n">rowcount</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">12345</span><span class="p">)</span>
<span class="o">/</span><span class="p">(</span><span class="n">reads_</span><span class="o">*</span><span class="n">reads_</span><span class="p">)</span>
<span class="o">&lt;</span> <span class="p">((</span><span class="k">select</span> <span class="k">count</span> <span class="k">from</span> <span class="n">rowcount</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">100</span><span class="p">))</span>
  <span class="o">/</span><span class="p">(</span><span class="k">select</span> <span class="k">AVG</span><span class="p">(</span><span class="n">reads_</span><span class="o">*</span><span class="n">reads_</span><span class="p">)</span> <span class="k">from</span> <span class="n">content_popularity</span><span class="p">)</span>
<span class="p">;</span>
</code></pre>
</div>
<p>Divide the hash by the number of reads squared. The greater the number of reads the lower the resulting \(hash \over reads^2\) value and the more likely it will be below the sampling cutoff (which we need to adjust for the number of reads).</p>

<h4 id="subject-data">Subject data</h4>
<p>Each content item has zero or more subject terms associated with it in the database. These are the terms from a controlled vocabulary that have been manually applied. This is going to be the base dataset that we are comparing the semantic extraction tools against.</p>

<p>Our subjects view has three columns, id_, sourcedocument, value. sourcedocument is the content item that has that subject tag, value is the text version of the subject tag and id_ is the unique identifier for the subject.</p>

<p>First lets turn the query above that generates a sample into a view by adding one line in front of it.</p>
<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">create</span> <span class="k">view</span> <span class="n">sem_sample_weight_squared</span> <span class="k">as</span>
  <span class="k">with</span>
    <span class="n">content_popularity</span> <span class="k">as</span> <span class="p">(</span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">content</span> <span class="k">join</span> <span class="n">popularity</span> <span class="k">on</span> <span class="n">content</span><span class="p">.</span><span class="n">id_</span><span class="o">=</span><span class="n">popularity</span><span class="p">.</span><span class="n">id_</span><span class="p">),</span>
    <span class="n">rowcount</span> <span class="k">as</span> <span class="p">(</span><span class="k">select</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">count_</span> <span class="k">from</span> <span class="n">content</span><span class="p">)</span>
  <span class="k">select</span> <span class="n">content_popularity</span><span class="p">.</span><span class="n">id_</span><span class="p">,</span> <span class="n">content_popularity</span><span class="p">.</span><span class="n">reads_</span>
  <span class="k">from</span> <span class="n">content_popularity</span>
  <span class="k">where</span>   <span class="n">ORA_HASH</span><span class="p">(</span><span class="n">id_</span><span class="p">,</span> <span class="p">(</span><span class="k">select</span> <span class="n">count_</span> <span class="k">from</span> <span class="n">rowcount</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">12345</span><span class="p">)</span>
  <span class="o">/</span><span class="p">(</span><span class="n">reads_</span><span class="o">*</span><span class="n">reads_</span><span class="p">)</span>
  <span class="o">&lt;</span> <span class="p">((</span><span class="k">select</span> <span class="k">count</span> <span class="k">from</span> <span class="n">rowcount</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">100</span><span class="p">))</span>
    <span class="o">/</span><span class="p">(</span><span class="k">select</span> <span class="k">AVG</span><span class="p">(</span><span class="n">reads_</span><span class="o">*</span><span class="n">reads_</span><span class="p">)</span> <span class="k">from</span> <span class="n">content_popularity</span><span class="p">)</span>
  <span class="p">;</span>
</code></pre>
</div>
<p>Then we can join the sem_sample_weight_squared view to the subjects view</p>
<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">select</span>
<span class="n">sem_sample_weight_squared</span><span class="p">.</span><span class="n">id_</span><span class="p">,</span>
<span class="n">sem_sample_weight_squared</span><span class="p">.</span><span class="n">reads_</span><span class="p">,</span>
<span class="n">subjects</span><span class="p">.</span><span class="n">id_</span> <span class="k">as</span> <span class="n">subject_id_</span><span class="p">,</span>
<span class="n">subjects</span><span class="p">.</span><span class="n">value</span> <span class="k">as</span> <span class="n">subject_</span>
<span class="k">from</span> <span class="n">sem_sample_weight_squared</span>
<span class="k">join</span>
<span class="n">subjects</span>
<span class="k">on</span> <span class="n">sem_sample_weight_squared</span><span class="p">.</span><span class="n">id_</span><span class="o">=</span><span class="n">subjects</span><span class="p">.</span><span class="n">sourcedocument</span><span class="p">;</span>
</code></pre>
</div>

<p>We get back a table with 4 columns, the content id, the number of reads of that piece of content, the subject id and the subject text associated with that piece of content.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">id_</th>
      <th style="text-align: left">reads_</th>
      <th style="text-align: left">subject_id_</th>
      <th style="text-align: left">subject_</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">6383402</td>
      <td style="text-align: left">606</td>
      <td style="text-align: left">1982</td>
      <td style="text-align: left">Crime</td>
    </tr>
    <tr>
      <td style="text-align: left">6395312</td>
      <td style="text-align: left">374</td>
      <td style="text-align: left">1462</td>
      <td style="text-align: left">Water Pollution</td>
    </tr>
    <tr>
      <td style="text-align: left">6423548</td>
      <td style="text-align: left">378</td>
      <td style="text-align: left">804</td>
      <td style="text-align: left">Television</td>
    </tr>
    <tr>
      <td style="text-align: left">6423548</td>
      <td style="text-align: left">378</td>
      <td style="text-align: left">504</td>
      <td style="text-align: left">Actor</td>
    </tr>
    <tr>
      <td style="text-align: left">6393190</td>
      <td style="text-align: left">234</td>
      <td style="text-align: left">1814</td>
      <td style="text-align: left">Obesity</td>
    </tr>
    <tr>
      <td style="text-align: left">5812472</td>
      <td style="text-align: left">894</td>
      <td style="text-align: left">2248</td>
      <td style="text-align: left">Quarantine</td>
    </tr>
    <tr>
      <td style="text-align: left">6337620</td>
      <td style="text-align: left">702</td>
      <td style="text-align: left">954</td>
      <td style="text-align: left">Community and Society</td>
    </tr>
    <tr>
      <td style="text-align: left">7865456</td>
      <td style="text-align: left">1096</td>
      <td style="text-align: left">2348</td>
      <td style="text-align: left">Neuroscience</td>
    </tr>
    <tr>
      <td style="text-align: left">6492758</td>
      <td style="text-align: left">824</td>
      <td style="text-align: left">1970</td>
      <td style="text-align: left">Law, Crime and Justice</td>
    </tr>
    <tr>
      <td style="text-align: left">6500564</td>
      <td style="text-align: left">26</td>
      <td style="text-align: left">1604</td>
      <td style="text-align: left">Local Government</td>
    </tr>
    <tr>
      <td style="text-align: left">6504948</td>
      <td style="text-align: left">202</td>
      <td style="text-align: left">2168</td>
      <td style="text-align: left">Livestock</td>
    </tr>
  </tbody>
</table>

<h3 id="calling-the-semantic-extraction-service">Calling the semantic extraction service</h3>
<p>For this section we will be working completly in r.</p>

<p>First some libraries (you might need to install these packages if you haven’t already done so)</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">reshape2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">stringr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">httr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">jsonlite</span><span class="p">)</span></code></pre></figure>

<p>Load the popularity data which also has some columns we don’t need.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">popularity</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"data/popularity.csv"</span><span class="p">)</span><span class="w">
</span><span class="c1"># quick check that the import seems to work properly.
# we should not see any numbers in this result
</span><span class="n">unique</span><span class="p">(</span><span class="n">popularity</span><span class="o">$</span><span class="n">SOURCE</span><span class="p">)</span><span class="w">
</span><span class="c1">## [1] " unknown "  " search "   " "          " social "   " internal "
## [6] " "           " email2 "
</span><span class="o">&gt;</span></code></pre></figure>

<p>Some tidying of the popularity data to get the popularity data frame we described at the beginning of the blog.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># extract the doc IDs
</span><span class="n">popularity</span><span class="o">$</span><span class="n">id</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="n">str_split</span><span class="p">(</span><span class="n">popularity</span><span class="o">$</span><span class="n">PATH</span><span class="p">,</span><span class="s2">"/"</span><span class="p">),</span><span class="w"> </span><span class="n">tail</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="c1"># only keep the results that are numbers
</span><span class="n">popularity</span><span class="o">$</span><span class="n">id</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">popularity</span><span class="o">$</span><span class="n">id</span><span class="p">)))</span><span class="w">
</span><span class="n">popularity.import</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">popularity</span><span class="w">
</span><span class="c1"># simplify the popularity table down to just the reads and ids
</span><span class="n">popularity</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">droplevels</span><span class="p">(</span><span class="n">as.data.frame</span><span class="p">(</span><span class="w">
  </span><span class="n">popularity.import</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">group_by</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">reads</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">READS</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">reads</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">
</span><span class="p">))</span><span class="w">

</span><span class="n">str</span><span class="p">(</span><span class="n">popularity</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## 'data.frame':	295000 obs. of  2 variables:
##  $ id   : Factor w/ 295000 levels "26910","26916",..: 1 2 3 4 5 6 7 8 9 10 ...
##  $ reads: int  2 2 1 2 14 2 18 1 10 1 ...</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">hist</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">popularity</span><span class="o">$</span><span class="n">reads</span><span class="p">))</span></code></pre></figure>

<p><img src="/figures/unnamed-chunk-2-1.svg" alt="plot of chunk unnamed-chunk-2" />
Now we load the content data with subjects and popularity we created in oracle</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">content</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"data/articles_subjects_reads.csv"</span><span class="p">)</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="o">&lt;-</span><span class="n">tolower</span><span class="p">(</span><span class="n">colnames</span><span class="p">(</span><span class="n">content</span><span class="p">))</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">content</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## 'data.frame':	9846 obs. of  4 variables:
##  $ id_        : int  891194 899582 899582 1027260 994510 994510 1896798 2415632 2415632 2347772 ...
##  $ reads_     : int  1 175 175 52 174 174 238 1354 1354 302 ...
##  $ subject_id_: int  1616 1922 954 808 2298 954 1834 1498 1226 1934 ...
##  $ subject_   : chr  "Health" "Human Interest" "Community and Society" "Business, Economics and Finance" ...</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">hist</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">content</span><span class="o">$</span><span class="n">reads_</span><span class="p">))</span></code></pre></figure>

<p><img src="/figures/unnamed-chunk-3-1.svg" alt="plot of chunk unnamed-chunk-3" /></p>

<p>Next we create a function to generate subject tags for each of our content items using one of the semantic extraction tools.
This r function is calling an AWS lambda function we have written that gets the text of the content,  passes it to a semantic extraction service and returns the results as JSON. In this case we are trying the meaningcloud service but we could swap this out for any other API that will return json results.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">mc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">DOC_ID</span><span class="p">){</span><span class="w">
  </span><span class="n">path</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"/test/api/v1/id/"</span><span class="w">
  </span><span class="n">url</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">amazon</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="n">dns</span><span class="o">&gt;</span><span class="w">
  </span><span class="n">mc_result</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">GET</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="o">=</span><span class="n">paste</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">DOC_ID</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s2">""</span><span class="p">))</span><span class="w">
  </span><span class="n">this.content</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fromJSON</span><span class="p">(</span><span class="n">rawToChar</span><span class="p">(</span><span class="n">mc_result</span><span class="o">$</span><span class="n">content</span><span class="p">))</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">this.content</span><span class="o">$</span><span class="n">category_list</span><span class="p">)</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>The lambda function we are calling looks like:</p>
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kr">import</span> <span class="nx">os</span>
<span class="kr">import</span> <span class="nx">requests</span>

<span class="nx">def</span> <span class="nx">lambda_handler</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span><span class="err">:</span>
    <span class="err">#</span><span class="nx">AWS</span> <span class="nx">Lambda</span> <span class="nx">environment</span> <span class="nx">variables</span>
    <span class="err">#</span><span class="nx">zip</span> <span class="o">-</span><span class="nx">r</span> <span class="o">-</span><span class="nx">X</span> <span class="nx">mc</span><span class="p">.</span><span class="nx">zip</span> <span class="o">*</span>
    <span class="err">#</span><span class="nx">st</span> <span class="nx">the</span> <span class="nx">following</span> <span class="nx">environment</span> <span class="nx">variables</span>
    <span class="err">#</span><span class="nx">meaningcloud_domain</span> <span class="o">=</span> <span class="nx">http</span><span class="err">:</span><span class="c1">//api.meaningcloud.com</span>
    <span class="err">#</span><span class="nx">meaningcloud_endpoint_topics</span> <span class="o">=</span> <span class="sr">/topics-2.</span><span class="err">0
</span>    <span class="err">#</span><span class="nx">meaningcloud_endpoint_class</span> <span class="o">=</span> <span class="sr">/class-1.</span><span class="err">1
</span>    <span class="err">#</span><span class="nx">meaningcloud_APIKEY</span> <span class="o">=</span> <span class="o">&lt;&lt;</span><span class="nx">Sign</span> <span class="nx">up</span> <span class="k">for</span> <span class="nx">an</span> <span class="nx">API</span> <span class="nx">Key</span><span class="o">&gt;&gt;</span>
    <span class="err">#</span><span class="nx">contentmanagement_address</span> <span class="o">=</span> <span class="o">&lt;&lt;</span><span class="nx">The</span> <span class="nx">API</span> <span class="nx">address</span> <span class="k">for</span> <span class="nx">your</span> <span class="nx">content</span><span class="o">&gt;&gt;</span>
    <span class="err">#</span><span class="nx">sample</span> <span class="nx">doc</span> <span class="nx">id</span> <span class="mi">4396552</span>
    <span class="nx">documentid</span> <span class="o">=</span> <span class="nx">str</span><span class="p">(</span><span class="nx">event</span><span class="p">[</span><span class="s1">'document'</span><span class="p">])</span> <span class="err">#</span><span class="nx">Document</span> <span class="nx">ID</span> <span class="nx">is</span> <span class="nx">passed</span> <span class="k">in</span> <span class="nx">from</span> <span class="nx">the</span> <span class="nx">API</span> <span class="nx">service</span>
    <span class="nx">apikey</span> <span class="o">=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">environ</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"meaningcloud_APIKEY"</span><span class="p">)</span> <span class="err">#</span><span class="nx">meaningcloud</span> <span class="nx">API</span> <span class="nx">key</span>
    <span class="nx">meaningcloud</span> <span class="o">=</span> <span class="nx">str</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">environ</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"meaningcloud_domain"</span><span class="p">))</span>
    <span class="nx">endpoint</span> <span class="o">=</span> <span class="nx">str</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">environ</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"meaningcloud_endpoint_class"</span><span class="p">))</span> <span class="err">#</span><span class="nx">meaningcloud</span> <span class="nx">classification</span> <span class="nx">endpoint</span> <span class="nx">url</span> <span class="p">(</span><span class="nx">use</span> <span class="nx">meaningcloud_endpoint_topics</span> <span class="k">for</span> <span class="nx">topics</span><span class="p">)</span>
    <span class="nx">teststring</span> <span class="o">=</span> <span class="s2">"/topics-2.0?key=meaningcloud_api_key&amp;of=json&amp;lang=en&amp;ilang=en&amp;txt=Malcolm%20Turnbull&amp;tt=a&amp;uw=y"</span>

    <span class="nx">content_url</span><span class="o">=</span><span class="nx">os</span><span class="p">.</span><span class="nx">environ</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"contentmanagement_address"</span><span class="p">)</span><span class="o">+</span><span class="nx">documentid</span>
    <span class="err">#</span><span class="nx">doc</span> <span class="o">=</span> <span class="nx">requests</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">wcms</span><span class="p">)</span>

    <span class="nx">url</span><span class="o">=</span><span class="nx">meaningcloud</span><span class="o">+</span><span class="nx">endpoint</span>
    <span class="err">#</span> <span class="nx">topic_params</span> <span class="o">=</span> <span class="p">{</span>  <span class="s1">'key'</span><span class="p">:</span><span class="nx">apikey</span><span class="p">,</span>
    <span class="err">#</span>             <span class="s1">'of'</span><span class="p">:</span><span class="s1">'json'</span><span class="p">,</span>
    <span class="err">#</span>             <span class="s1">'lang'</span><span class="p">:</span><span class="s1">'en'</span><span class="p">,</span>
    <span class="err">#</span>             <span class="s1">'txt'</span><span class="p">:</span><span class="nx">doc</span><span class="p">,</span>
    <span class="err">#</span>             <span class="s1">'textf'</span><span class="p">:</span><span class="s1">'html'</span><span class="p">,</span>
    <span class="err">#</span>             <span class="s1">'tt'</span><span class="p">:</span><span class="s1">'a'</span><span class="p">,</span>
    <span class="err">#</span>             <span class="s1">'uw'</span><span class="p">:</span><span class="s1">'y'</span>
    <span class="err">#</span>             <span class="p">}</span>
    <span class="nx">classification_params</span> <span class="o">=</span> <span class="p">{</span>  <span class="s1">'key'</span><span class="p">:</span><span class="nx">apikey</span><span class="p">,</span>
                <span class="s1">'of'</span><span class="p">:</span><span class="s1">'json'</span><span class="p">,</span>
                <span class="s1">'lang'</span><span class="p">:</span><span class="s1">'en'</span><span class="p">,</span>
                <span class="s1">'url'</span><span class="p">:</span><span class="nx">content_url</span><span class="p">,</span>
                <span class="err">#</span><span class="s1">'txt'</span><span class="p">:</span><span class="nx">doc</span><span class="p">,</span>
                <span class="err">#</span><span class="s1">'textf'</span><span class="p">:</span><span class="s1">'json'</span><span class="p">,</span>
                <span class="s1">'model'</span><span class="p">:</span><span class="s1">'IPTC_en'</span><span class="p">,</span>
                <span class="s1">'uw'</span><span class="p">:</span><span class="s1">'y'</span>
                <span class="p">}</span>

    <span class="nx">data1</span> <span class="o">=</span> <span class="nx">requests</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">data</span><span class="o">=</span><span class="nx">classification_params</span><span class="p">)</span>


    <span class="err">#</span><span class="nx">data1</span> <span class="o">=</span> <span class="nx">requests</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">meaningcloud</span><span class="o">+</span><span class="nx">teststring</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">data1</span><span class="err">:</span>
        <span class="k">return</span> <span class="nx">data1</span><span class="p">.</span><span class="nx">json</span><span class="p">()</span>
    <span class="k">return</span> <span class="nx">None</span> 
</code></pre>
</div>

<p>Lets run the r function on a single piece of content and see what we get back.</p>
<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">mc</span><span class="p">(</span><span class="s2">"32756"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<table>
  <thead>
    <tr>
      <th style="text-align: left"> </th>
      <th style="text-align: left">code</th>
      <th style="text-align: left">label</th>
      <th style="text-align: left">abs_relevance</th>
      <th style="text-align: left">relevance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">1</td>
      <td style="text-align: left">01018000</td>
      <td style="text-align: left">arts, culture and entertainment - monument and heritage site</td>
      <td style="text-align: left">0.9897062</td>
      <td style="text-align: left">100</td>
    </tr>
    <tr>
      <td style="text-align: left">2</td>
      <td style="text-align: left">01011000</td>
      <td style="text-align: left">arts, culture and entertainment - music</td>
      <td style="text-align: left">0.85201824</td>
      <td style="text-align: left">86</td>
    </tr>
  </tbody>
</table>

<p>Lets try it on a subset of our content.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">test_set</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">df.content</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">15</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"id_"</span><span class="p">)]))</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">test_set</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s2">"id_"</span><span class="p">)</span><span class="w">
</span><span class="n">test_result.orig</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="n">test_set</span><span class="o">$</span><span class="n">id_</span><span class="p">,</span><span class="n">mc</span><span class="p">,</span><span class="n">USE.NAMES</span><span class="o">=</span><span class="nb">F</span><span class="p">)</span><span class="w">
</span><span class="n">test_result.t</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">test_result.orig</span><span class="p">)</span><span class="w">
</span><span class="n">test_result</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">test_set</span><span class="p">,</span><span class="w"> </span><span class="n">test_result.t</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">test_result</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##       id_                                   code
## 1  891194                     14016000, 07005000
## 2  899582                               11007000
## 3 1027260                               04016011
## 4  994510                     03010001, 11007000
## 5 1896798                               07005000
## 6 2415632 04004000, 16000000, 15065000, 11001000
##                                                                                                                      label
## 1                                                                       social issue - abortion, health - medical research
## 2                                                                                                  politics - human rights
## 3                                                  economy, business and finance - company information - corporate officer
## 4                                      disaster and accident - transport accident - road accident, politics - human rights
## 5                                                                                                health - medical research
## 6 economy, business and finance - construction and property, unrest, conflicts and war, sport - tennis, politics - defence
##                                abs_relevance       relevance
## 1                         7.688963, 5.607054         100, 73
## 2                                  2.3600583             100
## 3                                   32.84538             100
## 4                        9.743005, 6.8584504         100, 70
## 5                                   36.62813             100
## 6 1.3771429, 1.3282492, 1.0405403, 0.8722501 100, 96, 76, 63</code></pre></figure>

<p>Now we are going to unpack the lists that came back from the semantic extraction api and repeat the ID for each entry.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">df.test</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">test_result</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">unnest</span><span class="p">()</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">df.test</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##       id_     code
## 1  891194 14016000
## 2  891194 07005000
## 3  899582 11007000
## 4 1027260 04016011
## 5  994510 03010001
## 6  994510 11007000
##                                                                     label
## 1                                                 social issue - abortion
## 2                                               health - medical research
## 3                                                 politics - human rights
## 4 economy, business and finance - company information - corporate officer
## 5              disaster and accident - transport accident - road accident
## 6                                                 politics - human rights
##   abs_relevance relevance
## 1      7.688963       100
## 2      5.607054        73
## 3     2.3600583       100
## 4      32.84538       100
## 5      9.743005       100
## 6     6.8584504        70</code></pre></figure>

<p>That looks useful so now we run the function against every record in the content data frame.
This takes a while and also uses up many of the free requests that MeaningCloud provides so we will want to make sure that we store the results.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># our dataframe has multiple rows for each id_ because a piece of content can have multiple subject tags
# we only want to make the call to MeaningCloud once per piece of content so we extract a list of unique ids
# First see if we already have a local copy of the data
</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">file.exists</span><span class="p">(</span><span class="s2">"data/df_complete.rds"</span><span class="p">)){</span><span class="w">
  </span><span class="n">complete_set</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">df.content</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">500</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s2">"id_"</span><span class="p">)]))</span><span class="w">
  </span><span class="n">colnames</span><span class="p">(</span><span class="n">complete_set</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s2">"id_"</span><span class="p">)</span><span class="w">
  </span><span class="c1">#for each id, pass it to our lambda API and get the meaningcloud result (using the mc function we wrote earlier)
</span><span class="w">  </span><span class="n">complete_result.orig</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="n">complete_set</span><span class="o">$</span><span class="n">id_</span><span class="p">,</span><span class="n">mc</span><span class="p">,</span><span class="n">USE.NAMES</span><span class="o">=</span><span class="nb">F</span><span class="p">)</span><span class="w">
  </span><span class="n">complete_result.t</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">complete_result.orig</span><span class="p">)</span><span class="w">
  </span><span class="n">saveRDS</span><span class="p">(</span><span class="n">complete_result.orig</span><span class="p">,</span><span class="s1">'complete_result_orig.rds'</span><span class="p">)</span><span class="w">
  </span><span class="c1"># bind the results from the API to the original id_ values so we know which document they refer to.
</span><span class="w">  </span><span class="n">complete_result</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">complete_set</span><span class="p">,</span><span class="w"> </span><span class="n">complete_result.t</span><span class="p">)</span><span class="w">
  </span><span class="c1"># unpack the lists that came back from the API into separate rows for each classification term.
</span><span class="w">  </span><span class="n">df.complete</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">complete_result</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">unnest</span><span class="p">()</span><span class="w">
  </span><span class="n">saveRDS</span><span class="p">(</span><span class="n">df.complete</span><span class="p">,</span><span class="s1">'data/df_complete.rds'</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="w">
  </span><span class="n">df.complete</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">readRDS</span><span class="p">(</span><span class="s1">'data/df_complete.rds'</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span></code></pre></figure>

<h3 id="matching-the-semantic-extraction-service-subjects-to-our-internal-subjects">matching the semantic extraction service subjects to our internal subjects</h3>
<p>We now have two sets of data ready to match.
df.complete has the semantic extraction service results and df.content has the existing internal results for the same pieces of content.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">head</span><span class="p">(</span><span class="n">df.complete</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##       id_     code
## 1  891194 14016000
## 2  891194 07005000
## 3  899582 11007000
## 4 1027260 04016011
## 5  994510 03010001
## 6  994510 11007000
##                                                                     label
## 1                                                 social issue - abortion
## 2                                               health - medical research
## 3                                                 politics - human rights
## 4 economy, business and finance - company information - corporate officer
## 5              disaster and accident - transport accident - road accident
## 6                                                 politics - human rights
##   abs_relevance relevance
## 1      7.688963       100
## 2      5.607054        73
## 3     2.3600583       100
## 4      32.84538       100
## 5      9.743005       100
## 6     6.8584504        70</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">head</span><span class="p">(</span><span class="n">df.content</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##       id_ reads_ subject_id_                        subject_
## 1  891194      1        1616                          Health
## 2  899582    175        1922                  Human Interest
## 3  899582    175         954           Community and Society
## 4 1027260     52         808 Business, Economics and Finance
## 5  994510    174        2298          Science and Technology
## 6  994510    174         954           Community and Society</code></pre></figure>

<p>This is where we run into our first stumbling block. How do we compare results when the internal results are using our internal taxonomy and the semantic service is using the IPTC taxonomy?
Luckily our hardworking archives team has created a mapping from our internal taxonomy to IPTC V3.0.
We can import that and map all of the internal subjects to IPTC V3.0.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">internal_subject_to_mediatopic</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"data/InternalSubjectTerm_mapped_to_IPTCMediaTopicCode.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">colClasses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'character'</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">internal_subject_to_mediatopic</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##                     Internal.term IPTC_media_topic
## 1          Law, Crime and Justice          2000000
## 2         Disasters and Accidents          3000000
## 3 Business, Economics and Finance          4000000
## 4                       Education          5000000
## 5             Access To Education          5000000
## 6           Educational Resources          5000000</code></pre></figure>

<p>But this is where we run into our second stumbling block. Meaning Cloud is returning IPTC V2.0 subjects!</p>

<p>Luckily (again) IPTC provides a mapping from IPTC V2.0 to IPTC V3.0.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">get_mediatopic_from_subjectcode</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">subjectcode</span><span class="p">){</span><span class="w">
  </span><span class="c1">#pass in an IPTC subjectcode as a string (beause of leading zeros being significant!)
</span><span class="w">  </span><span class="c1">#get back the corresponding IPTC mediatopic
</span><span class="w">  </span><span class="n">url</span><span class="o">=</span><span class="s2">"http://cv.iptc.org"</span><span class="w">
  </span><span class="n">path</span><span class="o">=</span><span class="n">paste</span><span class="p">(</span><span class="s2">"/newscodes/subjectcode/"</span><span class="p">,</span><span class="n">subjectcode</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span><span class="w"> </span><span class="c1">#?format=rdfxml
</span><span class="w">  </span><span class="n">mt_result</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">GET</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span><span class="w">
  </span><span class="n">mt_content</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rawToChar</span><span class="p">(</span><span class="n">mt_result</span><span class="o">$</span><span class="n">content</span><span class="p">)</span><span class="w">
  </span><span class="n">mt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sub</span><span class="p">(</span><span class="s2">".*mediatopic/"</span><span class="p">,</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">mt_content</span><span class="p">)</span><span class="w">
  </span><span class="n">mt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sub</span><span class="p">(</span><span class="s2">"\"&gt;medtop.*"</span><span class="p">,</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">mt</span><span class="p">)</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">mt</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">get_mt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">get_mediatopic_from_subjectcode</span><span class="w">

</span><span class="c1"># check the function works
</span><span class="n">mt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">get_mt</span><span class="p">(</span><span class="s2">"01005000"</span><span class="p">)</span><span class="w">
</span><span class="n">mt</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] "20000005"</code></pre></figure>

<p>If it is working as expected then we can run it on all the codes in our data</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">complete.iptc_subjectcodes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">df.complete</span><span class="o">$</span><span class="n">code</span><span class="p">)</span><span class="w">
</span><span class="n">complete.iptc_mediatopics</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="n">complete.iptc_subjectcodes</span><span class="p">,</span><span class="w"> </span><span class="n">get_mt</span><span class="p">)</span><span class="w">
</span><span class="n">iptc_subjectcodes_to_mediatopics</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">complete.iptc_subjectcodes</span><span class="p">,</span><span class="n">complete.iptc_mediatopics</span><span class="p">)</span><span class="w">
</span><span class="n">t</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">iptc_subjectcodes_to_mediatopics</span><span class="p">)</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"sc"</span><span class="p">,</span><span class="s2">"mt"</span><span class="p">)</span><span class="w">
</span><span class="n">t</span><span class="o">$</span><span class="n">mt</span><span class="p">[</span><span class="s2">"04008016"</span><span class="o">==</span><span class="n">t</span><span class="o">$</span><span class="n">sc</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"20000346"</span><span class="w"> </span><span class="c1"># the IPTC is missing a mapping for inflation and deflation. This maps these to macro economics - the parent category
</span><span class="n">iptc_subjectcodes_to_mediatopics</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">t</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">iptc_subjectcodes_to_mediatopics</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s2">"IPTC_subjectcode"</span><span class="p">,</span><span class="s2">"IPTC_media_topic"</span><span class="p">)</span><span class="w">
</span><span class="n">rm</span><span class="p">(</span><span class="n">t</span><span class="p">)</span></code></pre></figure>

<p>So we now have two mappings:</p>
<ul>
  <li>Our internal taxonomy -&gt; IPTC V3.0</li>
  <li>MeaningClouds IPTC V2.0 -&gt; IPTC V3.0</li>
</ul>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">head</span><span class="p">(</span><span class="n">internal_subject_to_mediatopic</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##                     Internal.term IPTC_media_topic
## 1          Law, Crime and Justice          2000000
## 2         Disasters and Accidents          3000000
## 3 Business, Economics and Finance          4000000
## 4                       Education          5000000
## 5             Access To Education          5000000
## 6           Educational Resources          5000000</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">head</span><span class="p">(</span><span class="n">iptc_subjectcodes_to_mediatopics</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##          IPTC_subjectcode IPTC_media_topic
## 14016000         14016000         20000785
## 07005000         07005000         20000737
## 11007000         11007000         20000592
## 04016011         04016011         20000190
## 03010001         03010001         20000147
## 04004000         04004000         20000235</code></pre></figure>

<p>Now we need to join our two sets of mappings back to our original content.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">df.content.mt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">left_join</span><span class="p">(</span><span class="n">df.content</span><span class="p">,</span><span class="n">internal_subject_to_mediatopic</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"subject_"</span><span class="o">=</span><span class="s2">"Internal.term"</span><span class="p">))</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">df.content.mt</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##       id_ reads_ subject_id_                        subject_
## 1  891194      1        1616                          Health
## 2  899582    175        1922                  Human Interest
## 3  899582    175         954           Community and Society
## 4 1027260     52         808 Business, Economics and Finance
## 5  994510    174        2298          Science and Technology
## 6  994510    174         954           Community and Society
##   IPTC_media_topic
## 1          7000000
## 2          8000000
## 3         14000000
## 4          4000000
## 5         13000000
## 6         14000000</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">df.complete.mt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">left_join</span><span class="p">(</span><span class="n">df.complete</span><span class="p">,</span><span class="n">iptc_subjectcodes_to_mediatopics</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"code"</span><span class="o">=</span><span class="s2">"IPTC_subjectcode"</span><span class="p">))</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">df.complete.mt</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##       id_     code
## 1  891194 14016000
## 2  891194 07005000
## 3  899582 11007000
## 4 1027260 04016011
## 5  994510 03010001
## 6  994510 11007000
##                                                                     label
## 1                                                 social issue - abortion
## 2                                               health - medical research
## 3                                                 politics - human rights
## 4 economy, business and finance - company information - corporate officer
## 5              disaster and accident - transport accident - road accident
## 6                                                 politics - human rights
##   abs_relevance relevance IPTC_media_topic
## 1      7.688963       100         20000785
## 2      5.607054        73         20000737
## 3     2.3600583       100         20000592
## 4      32.84538       100         20000190
## 5      9.743005       100         20000147
## 6     6.8584504        70         20000592</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">saveRDS</span><span class="p">(</span><span class="n">df.complete.mt</span><span class="p">,</span><span class="s1">'df.complete.mt.rds'</span><span class="p">)</span><span class="w">
</span><span class="n">saveRDS</span><span class="p">(</span><span class="n">df.content.mt</span><span class="p">,</span><span class="s1">'df.content.mt.rds'</span><span class="p">)</span></code></pre></figure>

<p>Join the two sets of data</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">df.mt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inner_join</span><span class="p">(</span><span class="n">df.content.mt</span><span class="p">,</span><span class="w"> </span><span class="n">df.complete.mt</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"id_"</span><span class="o">=</span><span class="s2">"id_"</span><span class="p">))</span><span class="w">
</span><span class="n">df.mt</span><span class="w"> </span><span class="o">&lt;-</span><span class="n">plyr</span><span class="o">::</span><span class="n">rename</span><span class="p">(</span><span class="n">df.mt</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s1">'IPTC_media_topic.x'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'IPTC_media_topic.Internal'</span><span class="p">))</span><span class="w">
</span><span class="n">df.mt</span><span class="w"> </span><span class="o">&lt;-</span><span class="n">plyr</span><span class="o">::</span><span class="n">rename</span><span class="p">(</span><span class="n">df.mt</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="s1">'IPTC_media_topic.y'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'IPTC_media_topic.MeaningCloud'</span><span class="p">))</span></code></pre></figure>

<p>Once we have done this we can make a start on trying to compare the two sets of classifications</p>

<h3 id="comparing-the-semantic-extraction-tools-results-to-our-internal-classifications">Comparing the Semantic Extraction Tools results to our internal classifications.</h3>
<p>We are going to be looking at three different ways of measuring how ‘good’ the results are.</p>

<h4 id="direct-comparison-of-iptc-v30-values">Direct comparison of IPTC V3.0 values</h4>
<p>How many times has MeaningCloud come up with exactly the same value as our internal classification process?</p>

<p>Note that in doing the latest join we have connected all the ‘guesses’ from MeaningCloud for a given content item to all of the subjects we assigned internally for that same content item. This means that the ‘best guess’ from MeaningCloud is being matched with every term from our internal subjects. It also means that the ‘worst guess’ from MeaningCloud is also being matched with every term from our internal subjects.</p>

<p>We could be generous and say that if MeaningCloud made a match it gets a point, and we will ignore the cases where it doesn’t match.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">total</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df.mt</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">unique</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">count</span><span class="p">()</span><span class="w">
</span><span class="n">correct</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">df.mt</span><span class="p">,</span><span class="n">IPTC_media_topic.Internal</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">IPTC_media_topic.MeaningCloud</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">unique</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">count</span><span class="p">()</span><span class="w">
</span><span class="n">correct</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## # A tibble: 1 x 1
##       n
##   &lt;int&gt;
## 1   145</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">total</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## # A tibble: 1 x 1
##       n
##   &lt;int&gt;
## 1   416</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">score_1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">correct</span><span class="o">/</span><span class="n">total</span><span class="o">*</span><span class="m">100</span><span class="w">
</span><span class="n">score_1</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##          n
## 1 34.85577</code></pre></figure>

<p>And say that in 34.9% of content items MeaningCloud got at least one classification exactly the same as our internal classifiers</p>

<p>The problem with this approach is that there would be no penalty for guessing the wrong terms. A semantic extraction tool could simply ‘guess’ ALL of the IPTC terms for every content items and receive a score of 100% using this method.</p>

<p>An alternative is to give it points for a match and deduct points for a miss.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">misses</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">df.mt</span><span class="p">,</span><span class="n">IPTC_media_topic.Internal</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">IPTC_media_topic.MeaningCloud</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">id_</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">unique</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">count</span><span class="p">()</span><span class="w">
</span><span class="n">misses</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## # A tibble: 1 x 1
##       n
##   &lt;int&gt;
## 1   413</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">score_2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">((</span><span class="n">correct</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">misses</span><span class="p">)</span><span class="o">/</span><span class="n">total</span><span class="p">)</span><span class="o">*</span><span class="m">100</span><span class="w">
</span><span class="n">score_2</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##           n
## 1 -64.42308</code></pre></figure>

<p>In this case we would identify that for almost all content items the tools has made at least one ‘guess’ that does not match our internal classifications. So it gets a score of -64.4%. It has missed the mark about twice as often as it hit the mark.</p>

<h4 id="how-close-is-close">How close is close?</h4>
<p>Given that a lot of classification decisions are somewhat subjective, only counting exact matches in our scoring is not going to give us a realistic picture of performance. We need some way to take into account close matches as as well as exact matches.</p>

<p>Here are two ways of answering the question of “how close is close?”. There are doubtless many other methods.</p>
<h5 id="path-distance">Path Distance</h5>
<p>IPTC V3.0 is a taxonomy that has a branching hierachy. It is almost (but not quite) a pure tree structure.</p>

<p>In a tree structure, we can count the number of steps to travel between one node and another and use that as our distance metric.
Parents have a score of 1 path length, sibiling and grandparents have a score of 2 path lengths, etc.
The more path segments we need to traverse, the further apart we can say two terms are in the taxonomy.</p>

<p>In a few places, a node in the IPTC V3.0 ‘tree’ has two parents. This slightly complicates our r code but it can be allowed for.</p>

<p>The first step is to import the taxonomy tree (which is downloadable from the IPTC website).</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># we need to set colClasses to character because the MediaTopic Codes have meaningful leading zeros
</span><span class="w"> </span><span class="n">IPTC.mc.parent_child</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"data/IPTC-MediaTopic-NewsCodes_ParentChild.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">colClasses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'character'</span><span class="p">)</span><span class="w">
 </span><span class="n">IPTC.mc.parent_child</span><span class="p">[</span><span class="n">nrow</span><span class="p">(</span><span class="n">IPTC.mc.parent_child</span><span class="p">)</span><span class="m">+1</span><span class="p">,]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"20000626"</span><span class="p">,</span><span class="s2">"20001174"</span><span class="p">)</span><span class="w"> </span><span class="c1">#The iptc excel sheet is missing this entry
</span><span class="w"> </span><span class="n">IPTC.mc.parent_child</span><span class="p">[</span><span class="n">nrow</span><span class="p">(</span><span class="n">IPTC.mc.parent_child</span><span class="p">)</span><span class="m">+1</span><span class="p">,]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"20001123"</span><span class="p">,</span><span class="s2">"20001177"</span><span class="p">)</span><span class="w"> </span><span class="c1">#The iptc excel sheet is missing this entry
</span><span class="w"> </span><span class="n">IPTC.mc.parent_child</span><span class="p">[</span><span class="n">nrow</span><span class="p">(</span><span class="n">IPTC.mc.parent_child</span><span class="p">)</span><span class="m">+1</span><span class="p">,]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"20001123"</span><span class="p">,</span><span class="s2">"20001178"</span><span class="p">)</span><span class="w"> </span><span class="err">#</span><span class="n">The</span><span class="w"> </span><span class="n">iptc</span><span class="w"> </span><span class="n">excel</span><span class="w"> </span><span class="n">sheet</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">missing</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">entry</span></code></pre></figure>

<p>Now we load this as a graph object so we can more easily measure path lengths</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">igraph</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tcltk</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">rgl</span><span class="p">)</span><span class="w">
</span><span class="n">links</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">IPTC.mc.parent_child</span><span class="w">
</span><span class="n">parents</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">links</span><span class="p">[,</span><span class="m">1</span><span class="p">])</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">parents</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"id"</span><span class="p">)</span><span class="w">
</span><span class="n">children</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">links</span><span class="p">[,</span><span class="m">2</span><span class="p">])</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">children</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"id"</span><span class="p">)</span><span class="w">
</span><span class="n">nodes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbind</span><span class="p">(</span><span class="n">parents</span><span class="p">,</span><span class="w"> </span><span class="n">children</span><span class="p">)</span><span class="w">
</span><span class="n">nodes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="o">!</span><span class="n">duplicated</span><span class="p">(</span><span class="n">nodes</span><span class="p">),])</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"id"</span><span class="p">)</span><span class="w">

</span><span class="n">net</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">graph_from_data_frame</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="n">links</span><span class="p">,</span><span class="w"> </span><span class="n">vertices</span><span class="o">=</span><span class="n">nodes</span><span class="p">,</span><span class="w"> </span><span class="n">directed</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
</span><span class="n">net</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## IGRAPH DN-- 1158 3548 --
## + attr: name (v/c)
## + edges (vertex names):
##  [1] Top     -&gt;01000000 Top     -&gt;02000000 Top     -&gt;03000000
##  [4] Top     -&gt;04000000 Top     -&gt;05000000 Top     -&gt;06000000
##  [7] Top     -&gt;07000000 Top     -&gt;08000000 Top     -&gt;09000000
## [10] Top     -&gt;10000000 Top     -&gt;11000000 Top     -&gt;12000000
## [13] Top     -&gt;13000000 Top     -&gt;14000000 Top     -&gt;15000000
## [16] Top     -&gt;16000000 Top     -&gt;17000000 01000000-&gt;20000002
## [19] 01000000-&gt;20000002 01000000-&gt;20000002 01000000-&gt;20000002
## [22] 01000000-&gt;20000002 01000000-&gt;20000002 01000000-&gt;20000002
## + ... omitted several edges</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">E</span><span class="p">(</span><span class="n">net</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## + 3548/3548 edges (vertex names):
##  [1] Top     -&gt;01000000 Top     -&gt;02000000 Top     -&gt;03000000
##  [4] Top     -&gt;04000000 Top     -&gt;05000000 Top     -&gt;06000000
##  [7] Top     -&gt;07000000 Top     -&gt;08000000 Top     -&gt;09000000
## [10] Top     -&gt;10000000 Top     -&gt;11000000 Top     -&gt;12000000
## [13] Top     -&gt;13000000 Top     -&gt;14000000 Top     -&gt;15000000
## [16] Top     -&gt;16000000 Top     -&gt;17000000 01000000-&gt;20000002
## [19] 01000000-&gt;20000002 01000000-&gt;20000002 01000000-&gt;20000002
## [22] 01000000-&gt;20000002 01000000-&gt;20000002 01000000-&gt;20000002
## [25] 01000000-&gt;20000002 01000000-&gt;20000002 01000000-&gt;20000002
## [28] 01000000-&gt;20000002 01000000-&gt;20000002 01000000-&gt;20000002
## + ... omitted several edges</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">V</span><span class="p">(</span><span class="n">net</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## + 1158/1158 vertices, named:
##    [1] Top      01000000 20000002 20000005 20000007 20000011 20000013
##    [8] 20000018 20000021 20000029 20000031 20000038 20000045 16000000
##   [15] 20000053 20000056 20000058 20000062 20000065 20000071 20000073
##   [22] 20000077 02000000 20000082 20000084 20000087 20000093 20000095
##   [29] 20000101 20000106 20000107 20000111 20000116 20000119 20000587
##   [36] 20000121 20000122 20000126 20000129 20000131 20000134 03000000
##   [43] 20000139 20000141 20000143 20000148 20000151 20000155 20000157
##   [50] 20000160 20000162 04000000 20000170 20000171 20000178 20000180
##   [57] 20000188 20000192 20000209 20000210 20000217 20000225 20000235
##   [64] 20000243 20000256 20000271 20000294 20000304 20000316 20000322
## + ... omitted several vertices</code></pre></figure>

<h6 id="metric-1---simple-path-distance">Metric 1 - Simple Path Distance</h6>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#Get the unique pairs of IPTC media topic codes
</span><span class="n">mt_pairs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df.mt</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">IPTC_media_topic.Internal</span><span class="p">,</span><span class="w"> </span><span class="n">IPTC_media_topic.MeaningCloud</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">unique</span><span class="p">()</span><span class="w">

</span><span class="c1">#create two groups of nodes (Internal and MeaningCloud) and measure the shortest distances between each combination.
</span><span class="n">P</span><span class="o">&lt;-</span><span class="n">mt_pairs</span><span class="p">[,</span><span class="m">1</span><span class="p">]</span><span class="w">
</span><span class="n">Q</span><span class="o">&lt;-</span><span class="n">mt_pairs</span><span class="p">[,</span><span class="m">2</span><span class="p">]</span><span class="w">
</span><span class="n">Vp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">net</span><span class="p">)[</span><span class="n">V</span><span class="p">(</span><span class="n">net</span><span class="p">)</span><span class="o">$</span><span class="n">name</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">P</span><span class="p">]</span><span class="w">
</span><span class="n">Vq</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">net</span><span class="p">)[</span><span class="n">V</span><span class="p">(</span><span class="n">net</span><span class="p">)</span><span class="o">$</span><span class="n">name</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">Q</span><span class="p">]</span><span class="w">
</span><span class="n">S</span><span class="o">&lt;-</span><span class="n">distances</span><span class="p">(</span><span class="n">net</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">Vp</span><span class="p">,</span><span class="n">to</span><span class="o">=</span><span class="n">Vq</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">S</span><span class="p">)</span><span class="w">  </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">kable</span><span class="p">()</span></code></pre></figure>

<table>
  <thead>
    <tr>
      <th style="text-align: left"> </th>
      <th style="text-align: right">20000002</th>
      <th style="text-align: right">20000005</th>
      <th style="text-align: right">20000011</th>
      <th style="text-align: right">20000013</th>
      <th style="text-align: right">20000018</th>
      <th style="text-align: right">16000000</th>
      <th style="text-align: right">20000053</th>
      <th style="text-align: right">20000062</th>
      <th style="text-align: right">20000065</th>
      <th style="text-align: right">20000082</th>
      <th style="text-align: right">20000101</th>
      <th style="text-align: right">20000106</th>
      <th style="text-align: right">20000111</th>
      <th style="text-align: right">20000119</th>
      <th style="text-align: right">20000131</th>
      <th style="text-align: right">20000134</th>
      <th style="text-align: right">03000000</th>
      <th style="text-align: right">20000151</th>
      <th style="text-align: right">20000157</th>
      <th style="text-align: right">04000000</th>
      <th style="text-align: right">20000170</th>
      <th style="text-align: right">20000210</th>
      <th style="text-align: right">20000225</th>
      <th style="text-align: right">20000235</th>
      <th style="text-align: right">20000243</th>
      <th style="text-align: right">20000256</th>
      <th style="text-align: right">20000304</th>
      <th style="text-align: right">20000322</th>
      <th style="text-align: right">20000344</th>
      <th style="text-align: right">20000346</th>
      <th style="text-align: right">20000373</th>
      <th style="text-align: right">20000385</th>
      <th style="text-align: right">20000392</th>
      <th style="text-align: right">20000394</th>
      <th style="text-align: right">05000000</th>
      <th style="text-align: right">20000400</th>
      <th style="text-align: right">20000418</th>
      <th style="text-align: right">20000420</th>
      <th style="text-align: right">20000432</th>
      <th style="text-align: right">20000437</th>
      <th style="text-align: right">20000441</th>
      <th style="text-align: right">07000000</th>
      <th style="text-align: right">20000451</th>
      <th style="text-align: right">20000458</th>
      <th style="text-align: right">20000464</th>
      <th style="text-align: right">20000480</th>
      <th style="text-align: right">20000487</th>
      <th style="text-align: right">08000000</th>
      <th style="text-align: right">09000000</th>
      <th style="text-align: right">20000509</th>
      <th style="text-align: right">20000518</th>
      <th style="text-align: right">20000521</th>
      <th style="text-align: right">20000529</th>
      <th style="text-align: right">20000540</th>
      <th style="text-align: right">20000551</th>
      <th style="text-align: right">20000568</th>
      <th style="text-align: right">20000574</th>
      <th style="text-align: right">20000593</th>
      <th style="text-align: right">20000598</th>
      <th style="text-align: right">20000607</th>
      <th style="text-align: right">20000615</th>
      <th style="text-align: right">20000345</th>
      <th style="text-align: right">20000649</th>
      <th style="text-align: right">20000653</th>
      <th style="text-align: right">12000000</th>
      <th style="text-align: right">20000657</th>
      <th style="text-align: right">13000000</th>
      <th style="text-align: right">20000717</th>
      <th style="text-align: right">20000735</th>
      <th style="text-align: right">20000756</th>
      <th style="text-align: right">20000770</th>
      <th style="text-align: right">20000771</th>
      <th style="text-align: right">20000780</th>
      <th style="text-align: right">20000808</th>
      <th style="text-align: right">20000817</th>
      <th style="text-align: right">20000856</th>
      <th style="text-align: right">20000923</th>
      <th style="text-align: right">20001071</th>
      <th style="text-align: right">17000000</th>
      <th style="text-align: right">20001123</th>
      <th style="text-align: right">20000003</th>
      <th style="text-align: right">20000006</th>
      <th style="text-align: right">20000026</th>
      <th style="text-align: right">20000027</th>
      <th style="text-align: right">20000036</th>
      <th style="text-align: right">20000040</th>
      <th style="text-align: right">20000042</th>
      <th style="text-align: right">20000043</th>
      <th style="text-align: right">20000048</th>
      <th style="text-align: right">20000051</th>
      <th style="text-align: right">20000057</th>
      <th style="text-align: right">20000085</th>
      <th style="text-align: right">20000096</th>
      <th style="text-align: right">20000099</th>
      <th style="text-align: right">20000104</th>
      <th style="text-align: right">20000105</th>
      <th style="text-align: right">20000127</th>
      <th style="text-align: right">20000132</th>
      <th style="text-align: right">20000133</th>
      <th style="text-align: right">20000137</th>
      <th style="text-align: right">20000144</th>
      <th style="text-align: right">20000145</th>
      <th style="text-align: right">20000147</th>
      <th style="text-align: right">20000150</th>
      <th style="text-align: right">20000152</th>
      <th style="text-align: right">20000153</th>
      <th style="text-align: right">20000154</th>
      <th style="text-align: right">20000158</th>
      <th style="text-align: right">20000159</th>
      <th style="text-align: right">20000176</th>
      <th style="text-align: right">20000184</th>
      <th style="text-align: right">20000186</th>
      <th style="text-align: right">20000190</th>
      <th style="text-align: right">20000195</th>
      <th style="text-align: right">20000204</th>
      <th style="text-align: right">20000212</th>
      <th style="text-align: right">20000213</th>
      <th style="text-align: right">20000215</th>
      <th style="text-align: right">20000220</th>
      <th style="text-align: right">20000222</th>
      <th style="text-align: right">20000223</th>
      <th style="text-align: right">20000224</th>
      <th style="text-align: right">20000233</th>
      <th style="text-align: right">20000237</th>
      <th style="text-align: right">20000238</th>
      <th style="text-align: right">20000240</th>
      <th style="text-align: right">20000254</th>
      <th style="text-align: right">20000259</th>
      <th style="text-align: right">20000268</th>
      <th style="text-align: right">20000273</th>
      <th style="text-align: right">20000274</th>
      <th style="text-align: right">20000280</th>
      <th style="text-align: right">20000296</th>
      <th style="text-align: right">20000305</th>
      <th style="text-align: right">20000313</th>
      <th style="text-align: right">20000320</th>
      <th style="text-align: right">20000324</th>
      <th style="text-align: right">20000330</th>
      <th style="text-align: right">20000332</th>
      <th style="text-align: right">20000338</th>
      <th style="text-align: right">20000340</th>
      <th style="text-align: right">20000341</th>
      <th style="text-align: right">20000343</th>
      <th style="text-align: right">20000349</th>
      <th style="text-align: right">20000353</th>
      <th style="text-align: right">20000354</th>
      <th style="text-align: right">20000362</th>
      <th style="text-align: right">20000371</th>
      <th style="text-align: right">20000372</th>
      <th style="text-align: right">20000375</th>
      <th style="text-align: right">20000379</th>
      <th style="text-align: right">20000381</th>
      <th style="text-align: right">20000399</th>
      <th style="text-align: right">20000401</th>
      <th style="text-align: right">20000412</th>
      <th style="text-align: right">20000415</th>
      <th style="text-align: right">20000416</th>
      <th style="text-align: right">20000428</th>
      <th style="text-align: right">20000429</th>
      <th style="text-align: right">20000431</th>
      <th style="text-align: right">20000436</th>
      <th style="text-align: right">20000439</th>
      <th style="text-align: right">20000440</th>
      <th style="text-align: right">20000443</th>
      <th style="text-align: right">20000454</th>
      <th style="text-align: right">20000455</th>
      <th style="text-align: right">20000466</th>
      <th style="text-align: right">20000492</th>
      <th style="text-align: right">20000494</th>
      <th style="text-align: right">20000495</th>
      <th style="text-align: right">20000498</th>
      <th style="text-align: right">20000506</th>
      <th style="text-align: right">20000507</th>
      <th style="text-align: right">20000511</th>
      <th style="text-align: right">20000522</th>
      <th style="text-align: right">20000523</th>
      <th style="text-align: right">20000534</th>
      <th style="text-align: right">20000536</th>
      <th style="text-align: right">20000552</th>
      <th style="text-align: right">20000557</th>
      <th style="text-align: right">20000562</th>
      <th style="text-align: right">20000564</th>
      <th style="text-align: right">20000570</th>
      <th style="text-align: right">20000584</th>
      <th style="text-align: right">20000592</th>
      <th style="text-align: right">20000605</th>
      <th style="text-align: right">20000606</th>
      <th style="text-align: right">20000612</th>
      <th style="text-align: right">20000613</th>
      <th style="text-align: right">20000618</th>
      <th style="text-align: right">20000628</th>
      <th style="text-align: right">20000629</th>
      <th style="text-align: right">20000634</th>
      <th style="text-align: right">20000635</th>
      <th style="text-align: right">20000640</th>
      <th style="text-align: right">20000643</th>
      <th style="text-align: right">20000645</th>
      <th style="text-align: right">20000646</th>
      <th style="text-align: right">20000651</th>
      <th style="text-align: right">20000665</th>
      <th style="text-align: right">20000702</th>
      <th style="text-align: right">20000707</th>
      <th style="text-align: right">20000715</th>
      <th style="text-align: right">20000718</th>
      <th style="text-align: right">20000720</th>
      <th style="text-align: right">20000721</th>
      <th style="text-align: right">20000734</th>
      <th style="text-align: right">20000737</th>
      <th style="text-align: right">20000739</th>
      <th style="text-align: right">20000759</th>
      <th style="text-align: right">20000761</th>
      <th style="text-align: right">20000773</th>
      <th style="text-align: right">20000774</th>
      <th style="text-align: right">20000777</th>
      <th style="text-align: right">20000782</th>
      <th style="text-align: right">20000785</th>
      <th style="text-align: right">20000786</th>
      <th style="text-align: right">20000791</th>
      <th style="text-align: right">20000792</th>
      <th style="text-align: right">20000795</th>
      <th style="text-align: right">20000798</th>
      <th style="text-align: right">20000800</th>
      <th style="text-align: right">20000803</th>
      <th style="text-align: right">20000804</th>
      <th style="text-align: right">20000815</th>
      <th style="text-align: right">20000820</th>
      <th style="text-align: right">20000851</th>
      <th style="text-align: right">20000994</th>
      <th style="text-align: right">20001035</th>
      <th style="text-align: right">20001085</th>
      <th style="text-align: right">20001092</th>
      <th style="text-align: right">20001116</th>
      <th style="text-align: right">20001121</th>
      <th style="text-align: right">20001131</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">20000002</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">4</td>
    </tr>
    <tr>
      <td style="text-align: left">20000005</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
    </tr>
    <tr>
      <td style="text-align: left">20000011</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
    </tr>
    <tr>
      <td style="text-align: left">20000013</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
    </tr>
    <tr>
      <td style="text-align: left">20000018</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
    </tr>
    <tr>
      <td style="text-align: left">20000031</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">2</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">6</td>
      <td style="text-align: right">5</td>
    </tr>
  </tbody>
</table>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">S_long</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">melt</span><span class="p">(</span><span class="n">S</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">S_long</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">kable</span><span class="p">()</span></code></pre></figure>

<table>
  <thead>
    <tr>
      <th style="text-align: right">Var1</th>
      <th style="text-align: right">Var2</th>
      <th style="text-align: right">value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right">20000002</td>
      <td style="text-align: right">2e+07</td>
      <td style="text-align: right">0</td>
    </tr>
    <tr>
      <td style="text-align: right">20000005</td>
      <td style="text-align: right">2e+07</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: right">20000011</td>
      <td style="text-align: right">2e+07</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: right">20000013</td>
      <td style="text-align: right">2e+07</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: right">20000018</td>
      <td style="text-align: right">2e+07</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: right">20000031</td>
      <td style="text-align: right">2e+07</td>
      <td style="text-align: right">1</td>
    </tr>
  </tbody>
</table>

<p>Now we join the distances back to our source table:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">df.mt</span><span class="o">$</span><span class="n">Var1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">df.mt</span><span class="o">$</span><span class="n">IPTC_media_topic.Internal</span><span class="p">))</span><span class="w">
</span><span class="n">df.mt</span><span class="o">$</span><span class="n">Var2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">df.mt</span><span class="o">$</span><span class="n">IPTC_media_topic.MeaningCloud</span><span class="p">))</span><span class="w">
</span><span class="n">df.mt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">left_join</span><span class="p">(</span><span class="n">df.mt</span><span class="p">,</span><span class="w"> </span><span class="n">S_long</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Var1"</span><span class="o">=</span><span class="s2">"Var1"</span><span class="p">,</span><span class="s2">"Var2"</span><span class="o">=</span><span class="s2">"Var2"</span><span class="p">))</span><span class="w">
</span><span class="n">df.mt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df.mt</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">rename</span><span class="p">(</span><span class="n">simple_distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="n">Var1</span><span class="p">,</span><span class="w"> </span><span class="n">Var2</span><span class="p">))</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">df.mt</span><span class="p">)</span><span class="w">  </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">kable</span><span class="p">()</span></code></pre></figure>

<table>
  <thead>
    <tr>
      <th style="text-align: right">id_</th>
      <th style="text-align: right">reads_</th>
      <th style="text-align: right">subject_id_</th>
      <th style="text-align: left">subject_</th>
      <th style="text-align: left">IPTC_media_topic.Internal</th>
      <th style="text-align: left">code</th>
      <th style="text-align: left">label</th>
      <th style="text-align: left">abs_relevance</th>
      <th style="text-align: left">relevance</th>
      <th style="text-align: left">IPTC_media_topic.MeaningCloud</th>
      <th style="text-align: right">simple_distance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right">891194</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">1616</td>
      <td style="text-align: left">Health</td>
      <td style="text-align: left">07000000</td>
      <td style="text-align: left">14016000</td>
      <td style="text-align: left">social issue - abortion</td>
      <td style="text-align: left">7.688963</td>
      <td style="text-align: left">100</td>
      <td style="text-align: left">20000785</td>
      <td style="text-align: right">5</td>
    </tr>
    <tr>
      <td style="text-align: right">891194</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">1616</td>
      <td style="text-align: left">Health</td>
      <td style="text-align: left">07000000</td>
      <td style="text-align: left">07005000</td>
      <td style="text-align: left">health - medical research</td>
      <td style="text-align: left">5.607054</td>
      <td style="text-align: left">73</td>
      <td style="text-align: left">20000737</td>
      <td style="text-align: right">4</td>
    </tr>
    <tr>
      <td style="text-align: right">899582</td>
      <td style="text-align: right">175</td>
      <td style="text-align: right">1922</td>
      <td style="text-align: left">Human Interest</td>
      <td style="text-align: left">08000000</td>
      <td style="text-align: left">11007000</td>
      <td style="text-align: left">politics - human rights</td>
      <td style="text-align: left">2.3600583</td>
      <td style="text-align: left">100</td>
      <td style="text-align: left">20000592</td>
      <td style="text-align: right">4</td>
    </tr>
    <tr>
      <td style="text-align: right">899582</td>
      <td style="text-align: right">175</td>
      <td style="text-align: right">954</td>
      <td style="text-align: left">Community and Society</td>
      <td style="text-align: left">14000000</td>
      <td style="text-align: left">11007000</td>
      <td style="text-align: left">politics - human rights</td>
      <td style="text-align: left">2.3600583</td>
      <td style="text-align: left">100</td>
      <td style="text-align: left">20000592</td>
      <td style="text-align: right">4</td>
    </tr>
    <tr>
      <td style="text-align: right">1027260</td>
      <td style="text-align: right">52</td>
      <td style="text-align: right">808</td>
      <td style="text-align: left">Business, Economics and Finance</td>
      <td style="text-align: left">04000000</td>
      <td style="text-align: left">04016011</td>
      <td style="text-align: left">economy, business and finance - company information - corporate officer</td>
      <td style="text-align: left">32.84538</td>
      <td style="text-align: left">100</td>
      <td style="text-align: left">20000190</td>
      <td style="text-align: right">3</td>
    </tr>
    <tr>
      <td style="text-align: right">994510</td>
      <td style="text-align: right">174</td>
      <td style="text-align: right">2298</td>
      <td style="text-align: left">Science and Technology</td>
      <td style="text-align: left">13000000</td>
      <td style="text-align: left">03010001</td>
      <td style="text-align: left">disaster and accident - transport accident - road accident</td>
      <td style="text-align: left">9.743005</td>
      <td style="text-align: left">100</td>
      <td style="text-align: left">20000147</td>
      <td style="text-align: right">5</td>
    </tr>
  </tbody>
</table>

<p>Now we can see what sort of results we get if we look at close but not exact matches. A path distance of 1 is parents.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">df.mt</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">subject_</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="p">,</span><span class="w"> </span><span class="n">simple_distance</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">simple_distance</span><span class="o">==</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">head</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">kable</span><span class="p">()</span></code></pre></figure>

<table>
  <thead>
    <tr>
      <th style="text-align: left">subject_</th>
      <th style="text-align: left">label</th>
      <th style="text-align: right">simple_distance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Animals</td>
      <td style="text-align: left">human interest - curiosity</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: left">Community and Society</td>
      <td style="text-align: left">social issue - family</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: left">Retail</td>
      <td style="text-align: left">economy, business and finance - consumer goods</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: left">Internet Technology</td>
      <td style="text-align: left">science and technology - technology (general)</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: left">States and Territories</td>
      <td style="text-align: left">politics - government</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: left">Industry</td>
      <td style="text-align: left">economy, business and finance - consumer goods</td>
      <td style="text-align: right">1</td>
    </tr>
  </tbody>
</table>

<p>How does a path distance of 2 look? Grandparent and siblings.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">df.mt</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">subject_</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="p">,</span><span class="w"> </span><span class="n">simple_distance</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">simple_distance</span><span class="o">==</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">head</span><span class="p">()</span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">kable</span><span class="p">()</span></code></pre></figure>

<table>
  <thead>
    <tr>
      <th style="text-align: left">subject_</th>
      <th style="text-align: left">label</th>
      <th style="text-align: right">simple_distance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Veterans</td>
      <td style="text-align: left">politics - defence</td>
      <td style="text-align: right">2</td>
    </tr>
    <tr>
      <td style="text-align: left">Business, Economics and Finance</td>
      <td style="text-align: left">economy, business and finance - media</td>
      <td style="text-align: right">2</td>
    </tr>
    <tr>
      <td style="text-align: left">Industry</td>
      <td style="text-align: left">economy, business and finance - metal and mineral - mining</td>
      <td style="text-align: right">2</td>
    </tr>
    <tr>
      <td style="text-align: left">Copper</td>
      <td style="text-align: left">economy, business and finance - metal and mineral - mining</td>
      <td style="text-align: right">2</td>
    </tr>
    <tr>
      <td style="text-align: left">Business, Economics and Finance</td>
      <td style="text-align: left">economy, business and finance - market and exchange - securities</td>
      <td style="text-align: right">2</td>
    </tr>
    <tr>
      <td style="text-align: left">Work</td>
      <td style="text-align: left">labour - unions</td>
      <td style="text-align: right">2</td>
    </tr>
  </tbody>
</table>

<p>And a path distance of 3?</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">df.mt</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">subject_</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="p">,</span><span class="w"> </span><span class="n">simple_distance</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">simple_distance</span><span class="o">==</span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">head</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">kable</span><span class="p">()</span></code></pre></figure>

<table>
  <thead>
    <tr>
      <th style="text-align: left">subject_</th>
      <th style="text-align: left">label</th>
      <th style="text-align: right">simple_distance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Business, Economics and Finance</td>
      <td style="text-align: left">economy, business and finance - company information - corporate officer</td>
      <td style="text-align: right">3</td>
    </tr>
    <tr>
      <td style="text-align: left">Science and Technology</td>
      <td style="text-align: left">environmental issue - conservation</td>
      <td style="text-align: right">3</td>
    </tr>
    <tr>
      <td style="text-align: left">Science and Technology</td>
      <td style="text-align: left">environmental issue - nature</td>
      <td style="text-align: right">3</td>
    </tr>
    <tr>
      <td style="text-align: left">Business, Economics and Finance</td>
      <td style="text-align: left">economy, business and finance - transport - air transport</td>
      <td style="text-align: right">3</td>
    </tr>
    <tr>
      <td style="text-align: left">Rights</td>
      <td style="text-align: left">politics - human rights</td>
      <td style="text-align: right">3</td>
    </tr>
    <tr>
      <td style="text-align: left">Courts and Trials</td>
      <td style="text-align: left">crime, law and justice - punishment</td>
      <td style="text-align: right">3</td>
    </tr>
  </tbody>
</table>

<p>These are all close enough not to immediately be rejected as wrong.</p>

<p>What about the other extreme? The largest path distance in the taxonomy is 9</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">df.mt</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">subject_</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="p">,</span><span class="w"> </span><span class="n">simple_distance</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">simple_distance</span><span class="o">&gt;=</span><span class="m">8</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">head</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">kable</span><span class="p">()</span></code></pre></figure>

<table>
  <thead>
    <tr>
      <th style="text-align: left">subject_</th>
      <th style="text-align: left">label</th>
      <th style="text-align: right">simple_distance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Veterans</td>
      <td style="text-align: left">economy, business and finance - construction and property</td>
      <td style="text-align: right">8</td>
    </tr>
    <tr>
      <td style="text-align: left">Veterans</td>
      <td style="text-align: left">sport - tennis</td>
      <td style="text-align: right">8</td>
    </tr>
    <tr>
      <td style="text-align: left">Native Title</td>
      <td style="text-align: left">economy, business and finance - construction and property - land price</td>
      <td style="text-align: right">8</td>
    </tr>
    <tr>
      <td style="text-align: left">Suicide</td>
      <td style="text-align: left">economy, business and finance - media - radio industry</td>
      <td style="text-align: right">8</td>
    </tr>
    <tr>
      <td style="text-align: left">Oceans and Reefs</td>
      <td style="text-align: left">economy, business and finance - agriculture - fishing industry</td>
      <td style="text-align: right">8</td>
    </tr>
    <tr>
      <td style="text-align: left">Drought</td>
      <td style="text-align: left">economy, business and finance - construction and property - farms</td>
      <td style="text-align: right">8</td>
    </tr>
  </tbody>
</table>

<p>Even these don’t look universally wrong. Droughts:Farms,  Oceans and Reefs:fishing industry, and Tourism:railway are all plausible relationships to occur within a single story.</p>

<p>What does the distribution of distance scores look like?</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">hist</span><span class="p">(</span><span class="n">df.mt</span><span class="o">$</span><span class="n">simple_distance</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="o">=</span><span class="m">9</span><span class="p">)</span></code></pre></figure>

<p><img src="/figures/unnamed-chunk-12-1.svg" alt="plot of chunk unnamed-chunk-12" /></p>

<p>So this is the simple path distance profile for MeaningCloud on our sample data set.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">summary</span><span class="p">(</span><span class="n">df.mt</span><span class="o">$</span><span class="n">simple_distance</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's
##   0.000   3.000   4.000   4.115   6.000   9.000      40</code></pre></figure>

<h6 id="adjusted-path-distance">Adjusted Path Distance</h6>
<p>Simple path distance has a problem. Siblings at the top level of the taxonomy (e.g. Health and Politics) are the same distance away as siblings deeper in the taxonomy heirarchy (e.g. Oceans and Rivers) but in normal usage we would consider the second pair closer together than the first pair.</p>

<p>We can adjust the path distance score to take into account how far down the taxonomy tree we are.</p>

<p>With thanks to “On measuring of similarity between tree nodes” Gleb B. Sologub, 2011 for the approach.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">score</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">net</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">){</span><span class="w">
  </span><span class="c1">#print(paste(P,",",Q))
</span><span class="w">  </span><span class="n">tryCatch</span><span class="p">({</span><span class="w">
  </span><span class="c1">#adjusted path-based similarity per Sologub "On measuring of Similarity Between Tree Nodes"
</span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">P</span><span class="p">)</span><span class="o">|</span><span class="nf">is.na</span><span class="p">(</span><span class="n">Q</span><span class="p">)){</span><span class="w">
      </span><span class="nf">return</span><span class="p">(</span><span class="kc">NA</span><span class="p">)</span><span class="w"> </span><span class="c1"># if we are missing a score then the path distance is NA
</span><span class="w">  </span><span class="p">}</span><span class="k">else</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="n">P</span><span class="o">==</span><span class="n">Q</span><span class="p">){</span><span class="w">
      </span><span class="nf">return</span><span class="p">(</span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="c1"># where P and Q are the same we can skip the time consuming graph calculations
</span><span class="w">      </span><span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="w">
  </span><span class="n">Vp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">net</span><span class="p">)[</span><span class="n">V</span><span class="p">(</span><span class="n">net</span><span class="p">)</span><span class="o">$</span><span class="n">name</span><span class="o">==</span><span class="nf">as.character</span><span class="p">(</span><span class="n">P</span><span class="p">)]</span><span class="w">
  </span><span class="n">Vq</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">net</span><span class="p">)[</span><span class="n">V</span><span class="p">(</span><span class="n">net</span><span class="p">)</span><span class="o">$</span><span class="n">name</span><span class="o">==</span><span class="nf">as.character</span><span class="p">(</span><span class="n">Q</span><span class="p">)]</span><span class="w">
  </span><span class="n">Top</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">net</span><span class="p">)[</span><span class="n">V</span><span class="p">(</span><span class="n">net</span><span class="p">)</span><span class="o">$</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Top"</span><span class="p">]</span><span class="w">
  </span><span class="n">TopP_path</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">shortest_paths</span><span class="p">(</span><span class="n">net</span><span class="p">,</span><span class="n">Top</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">mode</span><span class="o">=</span><span class="s2">"all"</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="o">=</span><span class="s2">"both"</span><span class="p">)</span><span class="w"> </span><span class="c1"># find the path from Top to P
</span><span class="w">  </span><span class="n">TopQ_path</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">shortest_paths</span><span class="p">(</span><span class="n">net</span><span class="p">,</span><span class="n">Top</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">mode</span><span class="o">=</span><span class="s2">"all"</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="o">=</span><span class="s2">"both"</span><span class="p">)</span><span class="w"> </span><span class="c1"># find the path from Top to Q
</span><span class="w">  </span><span class="n">TopP_path.graph</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subgraph.edges</span><span class="p">(</span><span class="n">net</span><span class="p">,</span><span class="n">unlist</span><span class="p">(</span><span class="n">TopP_path</span><span class="o">$</span><span class="n">epath</span><span class="p">))</span><span class="w"> </span><span class="c1">#create a graph of the path from Top to P
</span><span class="w">  </span><span class="n">TopQ_path.graph</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subgraph.edges</span><span class="p">(</span><span class="n">net</span><span class="p">,</span><span class="n">unlist</span><span class="p">(</span><span class="n">TopQ_path</span><span class="o">$</span><span class="n">epath</span><span class="p">))</span><span class="w"> </span><span class="c1">#create a graph of the path from Top to Q
</span><span class="w">  </span><span class="n">Common_path.graph</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">intersection</span><span class="p">(</span><span class="n">TopP_path.graph</span><span class="p">,</span><span class="w"> </span><span class="n">TopQ_path.graph</span><span class="p">,</span><span class="w"> </span><span class="n">keep.all.vertices</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="c1">#create a graph of the intersection
</span><span class="w">  </span><span class="c1">#plot(Common_path.graph)
</span><span class="w">  </span><span class="c1">#degree(Common_path.graph, mode="out") == 0
</span><span class="w">  </span><span class="n">lca</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">which</span><span class="p">(</span><span class="n">degree</span><span class="p">(</span><span class="n">Common_path.graph</span><span class="p">,</span><span class="w"> </span><span class="n">mode</span><span class="o">=</span><span class="s2">"out"</span><span class="p">)</span><span class="o">==</span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="c1"># the lowest common ancestor is the only leaf node in this intersection graph
</span><span class="w">  </span><span class="n">lca</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">V</span><span class="p">(</span><span class="n">net</span><span class="p">)[</span><span class="n">V</span><span class="p">(</span><span class="n">net</span><span class="p">)</span><span class="o">$</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">lca</span><span class="p">)]</span><span class="w"> </span><span class="c1"># map the lca back to the corresponding node in net
</span><span class="w">  </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">distances</span><span class="p">(</span><span class="n">net</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="o">=</span><span class="n">lca</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="o">=</span><span class="n">Top</span><span class="p">)</span><span class="w">
  </span><span class="n">Y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">distances</span><span class="p">(</span><span class="n">net</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="o">=</span><span class="n">lca</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="o">=</span><span class="n">P</span><span class="p">)</span><span class="w">
  </span><span class="n">Z</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">distances</span><span class="p">(</span><span class="n">net</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="o">=</span><span class="n">lca</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="o">=</span><span class="n">Q</span><span class="p">)</span><span class="w">
  </span><span class="n">S</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">+</span><span class="n">X</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="m">1</span><span class="o">+</span><span class="n">X</span><span class="o">+</span><span class="n">Y</span><span class="o">+</span><span class="n">Z</span><span class="p">)</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">S</span><span class="p">)</span><span class="w"> </span><span class="c1">#S in this case S is actually a similarity measure (higher values are better). We want a distance measure (higher values are worse) so we will subtract S (which ranges from 0 to 1) from 1.
</span><span class="w">  </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="p">,</span><span class="w">
    </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">c</span><span class="o">$</span><span class="n">message</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="n">c</span><span class="o">$</span><span class="n">message</span><span class="p">,</span><span class="s2">" (P, Q = "</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="s2">", "</span><span class="p">,</span><span class="n">Q</span><span class="p">,</span><span class="s2">")"</span><span class="p">)</span><span class="w">
      </span><span class="n">stop</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">


</span><span class="n">P</span><span class="o">&lt;-</span><span class="nf">as.character</span><span class="p">(</span><span class="n">mt_pairs</span><span class="p">[,</span><span class="m">1</span><span class="p">])</span><span class="w">
</span><span class="n">Q</span><span class="o">&lt;-</span><span class="nf">as.character</span><span class="p">(</span><span class="n">mt_pairs</span><span class="p">[,</span><span class="m">2</span><span class="p">])</span><span class="w">
</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">file.exists</span><span class="p">(</span><span class="s2">"data/results.rds"</span><span class="p">)){</span><span class="w">
  </span><span class="n">results</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mapply</span><span class="p">(</span><span class="n">score</span><span class="p">,</span><span class="n">P</span><span class="o">=</span><span class="n">P</span><span class="p">,</span><span class="w"> </span><span class="n">Q</span><span class="o">=</span><span class="n">Q</span><span class="p">,</span><span class="w"> </span><span class="n">MoreArgs</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">net</span><span class="o">=</span><span class="n">net</span><span class="p">))</span><span class="w">
  </span><span class="n">saveRDS</span><span class="p">(</span><span class="n">results</span><span class="p">,</span><span class="s2">"data/results.rds"</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="w">
  </span><span class="n">results</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">readRDS</span><span class="p">(</span><span class="s2">"data/results.rds"</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">results</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##  Named num [1:2215] 0.833 0.8 0.8 0.8 0.6 ...
##  - attr(*, "names")= chr [1:2215] "07000000" "07000000" "08000000" "14000000" ...</code></pre></figure>

<p>Now we join the distances back to our source table:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">temp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">P</span><span class="p">),</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">Q</span><span class="p">),</span><span class="w"> </span><span class="n">adjusted_distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">results</span><span class="p">))</span><span class="w">
</span><span class="n">df.mt</span><span class="o">$</span><span class="n">Var1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">df.mt</span><span class="o">$</span><span class="n">IPTC_media_topic.Internal</span><span class="p">))</span><span class="w">
</span><span class="n">df.mt</span><span class="o">$</span><span class="n">Var2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">df.mt</span><span class="o">$</span><span class="n">IPTC_media_topic.MeaningCloud</span><span class="p">))</span><span class="w">
</span><span class="n">df.mt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">left_join</span><span class="p">(</span><span class="n">df.mt</span><span class="p">,</span><span class="w"> </span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Var1"</span><span class="o">=</span><span class="s2">"V1"</span><span class="p">,</span><span class="s2">"Var2"</span><span class="o">=</span><span class="s2">"V2"</span><span class="p">))</span><span class="w">
</span><span class="n">df.mt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df.mt</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="n">Var1</span><span class="p">,</span><span class="w"> </span><span class="n">Var2</span><span class="p">))</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">df.mt</span><span class="p">)</span><span class="w">  </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">kable</span><span class="p">()</span></code></pre></figure>

<table>
  <thead>
    <tr>
      <th style="text-align: right">id_</th>
      <th style="text-align: right">reads_</th>
      <th style="text-align: right">subject_id_</th>
      <th style="text-align: left">subject_</th>
      <th style="text-align: left">IPTC_media_topic.Internal</th>
      <th style="text-align: left">code</th>
      <th style="text-align: left">label</th>
      <th style="text-align: left">abs_relevance</th>
      <th style="text-align: left">relevance</th>
      <th style="text-align: left">IPTC_media_topic.MeaningCloud</th>
      <th style="text-align: right">simple_distance</th>
      <th style="text-align: right">adjusted_distance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right">891194</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">1616</td>
      <td style="text-align: left">Health</td>
      <td style="text-align: left">07000000</td>
      <td style="text-align: left">14016000</td>
      <td style="text-align: left">social issue - abortion</td>
      <td style="text-align: left">7.688963</td>
      <td style="text-align: left">100</td>
      <td style="text-align: left">20000785</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">0.8333333</td>
    </tr>
    <tr>
      <td style="text-align: right">891194</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">1616</td>
      <td style="text-align: left">Health</td>
      <td style="text-align: left">07000000</td>
      <td style="text-align: left">07005000</td>
      <td style="text-align: left">health - medical research</td>
      <td style="text-align: left">5.607054</td>
      <td style="text-align: left">73</td>
      <td style="text-align: left">20000737</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">0.8000000</td>
    </tr>
    <tr>
      <td style="text-align: right">899582</td>
      <td style="text-align: right">175</td>
      <td style="text-align: right">1922</td>
      <td style="text-align: left">Human Interest</td>
      <td style="text-align: left">08000000</td>
      <td style="text-align: left">11007000</td>
      <td style="text-align: left">politics - human rights</td>
      <td style="text-align: left">2.3600583</td>
      <td style="text-align: left">100</td>
      <td style="text-align: left">20000592</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">0.8000000</td>
    </tr>
    <tr>
      <td style="text-align: right">899582</td>
      <td style="text-align: right">175</td>
      <td style="text-align: right">954</td>
      <td style="text-align: left">Community and Society</td>
      <td style="text-align: left">14000000</td>
      <td style="text-align: left">11007000</td>
      <td style="text-align: left">politics - human rights</td>
      <td style="text-align: left">2.3600583</td>
      <td style="text-align: left">100</td>
      <td style="text-align: left">20000592</td>
      <td style="text-align: right">4</td>
      <td style="text-align: right">0.8000000</td>
    </tr>
    <tr>
      <td style="text-align: right">1027260</td>
      <td style="text-align: right">52</td>
      <td style="text-align: right">808</td>
      <td style="text-align: left">Business, Economics and Finance</td>
      <td style="text-align: left">04000000</td>
      <td style="text-align: left">04016011</td>
      <td style="text-align: left">economy, business and finance - company information - corporate officer</td>
      <td style="text-align: left">32.84538</td>
      <td style="text-align: left">100</td>
      <td style="text-align: left">20000190</td>
      <td style="text-align: right">3</td>
      <td style="text-align: right">0.6000000</td>
    </tr>
    <tr>
      <td style="text-align: right">994510</td>
      <td style="text-align: right">174</td>
      <td style="text-align: right">2298</td>
      <td style="text-align: left">Science and Technology</td>
      <td style="text-align: left">13000000</td>
      <td style="text-align: left">03010001</td>
      <td style="text-align: left">disaster and accident - transport accident - road accident</td>
      <td style="text-align: left">9.743005</td>
      <td style="text-align: left">100</td>
      <td style="text-align: left">20000147</td>
      <td style="text-align: right">5</td>
      <td style="text-align: right">0.8333333</td>
    </tr>
  </tbody>
</table>

<p>Now we can see what sort of results we get if we look at close but not exact matches using the adjusted path distance metric.
What does the distribution of adjusted path distance scores look like?</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">hist</span><span class="p">(</span><span class="n">df.mt</span><span class="o">$</span><span class="n">adjusted_distance</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="o">=</span><span class="m">10</span><span class="p">)</span></code></pre></figure>

<p><img src="/figures/unnamed-chunk-16-1.svg" alt="plot of chunk unnamed-chunk-16" /></p>

<p>It ranges from 0 to 1 with most values being quite small</p>

<p>So this is the adjusted path distance profile for MeaningCloud on our sample data set.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">summary</span><span class="p">(</span><span class="n">df.mt</span><span class="o">$</span><span class="n">adjusted_distance</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's
##  0.0000  0.6000  0.8000  0.6763  0.8571  0.9000      40</code></pre></figure>

<p>Exact matches</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">df.mt</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">subject_</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="p">,</span><span class="w"> </span><span class="n">adjusted_distance</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">adjusted_distance</span><span class="o">==</span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">head</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">kable</span><span class="p">()</span></code></pre></figure>

<table>
  <thead>
    <tr>
      <th style="text-align: left">subject_</th>
      <th style="text-align: left">label</th>
      <th style="text-align: right">adjusted_distance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Medical Research</td>
      <td style="text-align: left">health - medical research</td>
      <td style="text-align: right">0</td>
    </tr>
    <tr>
      <td style="text-align: left">Courts and Trials</td>
      <td style="text-align: left">crime, law and justice - judiciary (system of justice)</td>
      <td style="text-align: right">0</td>
    </tr>
    <tr>
      <td style="text-align: left">Educational Resources</td>
      <td style="text-align: left">education</td>
      <td style="text-align: right">0</td>
    </tr>
    <tr>
      <td style="text-align: left">Goat Production</td>
      <td style="text-align: left">economy, business and finance - agriculture - livestock farming</td>
      <td style="text-align: right">0</td>
    </tr>
    <tr>
      <td style="text-align: left">Fishing, Aquaculture</td>
      <td style="text-align: left">economy, business and finance - agriculture - fishing industry</td>
      <td style="text-align: right">0</td>
    </tr>
    <tr>
      <td style="text-align: left">Pornography</td>
      <td style="text-align: left">social issue - pornography</td>
      <td style="text-align: right">0</td>
    </tr>
  </tbody>
</table>

<p>Looking at some examples with an adjusted distance &lt; 0.2</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">df.mt</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">subject_</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="p">,</span><span class="w"> </span><span class="n">adjusted_distance</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">between</span><span class="p">(</span><span class="n">adjusted_distance</span><span class="p">,</span><span class="m">0.00001</span><span class="p">,</span><span class="m">0.2</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">head</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">kable</span><span class="p">()</span></code></pre></figure>

<table>
  <thead>
    <tr>
      <th style="text-align: left">subject_</th>
      <th style="text-align: left">label</th>
      <th style="text-align: right">adjusted_distance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Retail</td>
      <td style="text-align: left">economy, business and finance - consumer goods</td>
      <td style="text-align: right">0.2</td>
    </tr>
    <tr>
      <td style="text-align: left">Rural</td>
      <td style="text-align: left">economy, business and finance - agriculture - livestock farming</td>
      <td style="text-align: right">0.2</td>
    </tr>
    <tr>
      <td style="text-align: left">Agricultural Marketing</td>
      <td style="text-align: left">economy, business and finance - agriculture - livestock farming</td>
      <td style="text-align: right">0.2</td>
    </tr>
    <tr>
      <td style="text-align: left">Prisons and Punishment</td>
      <td style="text-align: left">crime, law and justice - prison</td>
      <td style="text-align: right">0.2</td>
    </tr>
    <tr>
      <td style="text-align: left">Prisons and Punishment</td>
      <td style="text-align: left">crime, law and justice - prison</td>
      <td style="text-align: right">0.2</td>
    </tr>
    <tr>
      <td style="text-align: left">Assault</td>
      <td style="text-align: left">crime, law and justice - crime - sexual assault</td>
      <td style="text-align: right">0.2</td>
    </tr>
  </tbody>
</table>

<p>Looking at some examples with an adjusted distance between 0.2 and 0.4</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">df.mt</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">subject_</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="p">,</span><span class="w"> </span><span class="n">adjusted_distance</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">between</span><span class="p">(</span><span class="n">adjusted_distance</span><span class="p">,</span><span class="m">0.2</span><span class="p">,</span><span class="m">0.4</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">head</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">kable</span><span class="p">()</span></code></pre></figure>

<table>
  <thead>
    <tr>
      <th style="text-align: left">subject_</th>
      <th style="text-align: left">label</th>
      <th style="text-align: right">adjusted_distance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Veterans</td>
      <td style="text-align: left">politics - defence</td>
      <td style="text-align: right">0.3333333</td>
    </tr>
    <tr>
      <td style="text-align: left">Animals</td>
      <td style="text-align: left">human interest - curiosity</td>
      <td style="text-align: right">0.3333333</td>
    </tr>
    <tr>
      <td style="text-align: left">Community and Society</td>
      <td style="text-align: left">social issue - family</td>
      <td style="text-align: right">0.3333333</td>
    </tr>
    <tr>
      <td style="text-align: left">Internet Technology</td>
      <td style="text-align: left">science and technology - technology (general)</td>
      <td style="text-align: right">0.2500000</td>
    </tr>
    <tr>
      <td style="text-align: left">Industry</td>
      <td style="text-align: left">economy, business and finance - metal and mineral - mining</td>
      <td style="text-align: right">0.4000000</td>
    </tr>
    <tr>
      <td style="text-align: left">Copper</td>
      <td style="text-align: left">economy, business and finance - metal and mineral - mining</td>
      <td style="text-align: right">0.3333333</td>
    </tr>
  </tbody>
</table>

<p>Looking at some examples with an adjusted distance between 0.4 and 0.6</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">df.mt</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">subject_</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="p">,</span><span class="w"> </span><span class="n">adjusted_distance</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">between</span><span class="p">(</span><span class="n">adjusted_distance</span><span class="p">,</span><span class="m">0.4</span><span class="p">,</span><span class="m">0.6</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">head</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">kable</span><span class="p">()</span></code></pre></figure>

<table>
  <thead>
    <tr>
      <th style="text-align: left">subject_</th>
      <th style="text-align: left">label</th>
      <th style="text-align: right">adjusted_distance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Business, Economics and Finance</td>
      <td style="text-align: left">economy, business and finance - company information - corporate officer</td>
      <td style="text-align: right">0.6</td>
    </tr>
    <tr>
      <td style="text-align: left">Business, Economics and Finance</td>
      <td style="text-align: left">economy, business and finance - media</td>
      <td style="text-align: right">0.5</td>
    </tr>
    <tr>
      <td style="text-align: left">Business, Economics and Finance</td>
      <td style="text-align: left">economy, business and finance - transport - air transport</td>
      <td style="text-align: right">0.6</td>
    </tr>
    <tr>
      <td style="text-align: left">Industry</td>
      <td style="text-align: left">economy, business and finance - metal and mineral - mining</td>
      <td style="text-align: right">0.4</td>
    </tr>
    <tr>
      <td style="text-align: left">Courts and Trials</td>
      <td style="text-align: left">crime, law and justice - punishment</td>
      <td style="text-align: right">0.6</td>
    </tr>
    <tr>
      <td style="text-align: left">Business, Economics and Finance</td>
      <td style="text-align: left">economy, business and finance - company information - credit ratings</td>
      <td style="text-align: right">0.6</td>
    </tr>
  </tbody>
</table>

<p>And some of the values with the larger adjusted distances</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">df.mt</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">subject_</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="p">,</span><span class="w"> </span><span class="n">adjusted_distance</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">between</span><span class="p">(</span><span class="n">adjusted_distance</span><span class="p">,</span><span class="m">0.8</span><span class="p">,</span><span class="m">0.9</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">head</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">kable</span><span class="p">()</span></code></pre></figure>

<table>
  <thead>
    <tr>
      <th style="text-align: left">subject_</th>
      <th style="text-align: left">label</th>
      <th style="text-align: right">adjusted_distance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Health</td>
      <td style="text-align: left">social issue - abortion</td>
      <td style="text-align: right">0.8333333</td>
    </tr>
    <tr>
      <td style="text-align: left">Health</td>
      <td style="text-align: left">health - medical research</td>
      <td style="text-align: right">0.8000000</td>
    </tr>
    <tr>
      <td style="text-align: left">Human Interest</td>
      <td style="text-align: left">politics - human rights</td>
      <td style="text-align: right">0.8000000</td>
    </tr>
    <tr>
      <td style="text-align: left">Community and Society</td>
      <td style="text-align: left">politics - human rights</td>
      <td style="text-align: right">0.8000000</td>
    </tr>
    <tr>
      <td style="text-align: left">Science and Technology</td>
      <td style="text-align: left">disaster and accident - transport accident - road accident</td>
      <td style="text-align: right">0.8333333</td>
    </tr>
    <tr>
      <td style="text-align: left">Science and Technology</td>
      <td style="text-align: left">politics - human rights</td>
      <td style="text-align: right">0.8000000</td>
    </tr>
  </tbody>
</table>

<p>And then the ones that are furthest apart</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">df.mt</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">subject_</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="p">,</span><span class="w"> </span><span class="n">adjusted_distance</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">between</span><span class="p">(</span><span class="n">adjusted_distance</span><span class="p">,</span><span class="m">0.9</span><span class="p">,</span><span class="m">1.0</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">head</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">kable</span><span class="p">()</span></code></pre></figure>

<table>
  <thead>
    <tr>
      <th style="text-align: left">subject_</th>
      <th style="text-align: left">label</th>
      <th style="text-align: right">adjusted_distance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">University and Further Education</td>
      <td style="text-align: left">arts, culture and entertainment - music - popular music</td>
      <td style="text-align: right">0.9</td>
    </tr>
    <tr>
      <td style="text-align: left">Tourism</td>
      <td style="text-align: left">economy, business and finance - macro economics - consumer issue</td>
      <td style="text-align: right">0.9</td>
    </tr>
    <tr>
      <td style="text-align: left">Storm Event</td>
      <td style="text-align: left">arts, culture and entertainment - nightclub</td>
      <td style="text-align: right">0.9</td>
    </tr>
  </tbody>
</table>

<h3 id="correlations">Correlations</h3>
<p>Lets plot the correlation between the MeaningCloud classification and the Internal classification</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># First we need to create numeric versions of our classification codes
# At the moment one is a character variable and the other is a factor
</span><span class="n">df.mt</span><span class="o">$</span><span class="n">IPTC_media_topic.MeaningCloud</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">df.mt</span><span class="o">$</span><span class="n">IPTC_media_topic.MeaningCloud</span><span class="p">)</span><span class="w">
</span><span class="n">df.mt</span><span class="o">$</span><span class="n">IPTC_Internal</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">df.mt</span><span class="o">$</span><span class="n">IPTC_media_topic.Internal</span><span class="p">))</span><span class="w">
</span><span class="n">df.mt</span><span class="o">$</span><span class="n">IPTC_MeaningCloud</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">df.mt</span><span class="o">$</span><span class="n">IPTC_media_topic.MeaningCloud</span><span class="p">))</span><span class="w">
</span><span class="n">options</span><span class="p">(</span><span class="n">scipen</span><span class="o">=</span><span class="m">999</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">df.mt</span><span class="o">$</span><span class="n">IPTC_media_topic.Internal</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##  chr [1:3185] "07000000" "07000000" "08000000" "14000000" ...</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">str</span><span class="p">(</span><span class="n">df.mt</span><span class="o">$</span><span class="n">IPTC_media_topic.MeaningCloud</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##  Factor w/ 234 levels "03000000","04000000",..: 210 198 166 166 61 48 166 48 166 198 ...</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">str</span><span class="p">(</span><span class="n">df.mt</span><span class="o">$</span><span class="n">IPTC_Internal</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##  num [1:3185] 7000000 7000000 8000000 14000000 4000000 ...</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">str</span><span class="p">(</span><span class="n">df.mt</span><span class="o">$</span><span class="n">IPTC_MeaningCloud</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##  num [1:3185] 20000785 20000737 20000592 20000592 20000190 ...</code></pre></figure>


  </div>
  <div class="PageNavigation">
    
      <a class="prev" href="/oracle/2017/07/26/uploading-an-oracle-db-to-aws-rds.html">&laquo; Uploading an Oracle Database Dump File to AWS RDS</a>
    
    
  </div>

  
</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Michael&#39;s Notes</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
            
              Michael&#39;s Notes
            
            </li>
            
            <li><a href="mailto:your-email@example.com">your-email@example.com</a></li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/michaele4321"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">michaele4321</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/Michael_E4321"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">Michael_E4321</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>A blog to preserve interesting problems and solutions.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
